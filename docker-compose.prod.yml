version: "3.8"

services:
  backend:
    # Usamos la imagen ya construida y subida a Docker Hub
    image: kenner23016/atech-backend:${TAG}
    env_file:
      - .env.prod
    # Solo expuesto en loopback del host (para que el Nginx del servidor lo vea)
    ports:
      - "127.0.0.1:8080:8080"
    networks:
      - appnet

  frontend:
    # AHORA: Angular dev server con proxy.conf.json en lugar de Nginx
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    depends_on:
      - backend
    # No es estrictamente necesario, pero as√≠ tienes las mismas vars
    env_file:
      - .env.prod
    environment:
      # El dev server escucha en todas las interfaces del contenedor
      HOST: 0.0.0.0
    # Exponemos el Angular dev server en el 8081 del host
    ports:
      - "127.0.0.1:8081:4200"
    networks:
      - appnet

networks:
  appnet: {}

